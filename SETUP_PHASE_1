#for ARM

#remove systemd since this is for debian not devuan
#not working since there are some hdmi related scripts for systemd
#sudo apt-get install sysvinit-core sysvinit sysvinit-utils

#add a user
echo "Please specify pi as user here or you will have a bad time"
sudo chmod +x ADDUSER_NOT_CRAP_VERSION
sudo ./ADDUSER_NOT_CRAP_VERSION
sudo mkdir /home/pi
sudo chown -R pi:pi /home/pi
echo "Any password should do here"
sudo passwd pi
sudo chsh pi -s /usr/bin/bash

#install a kernel similar to stock but with usb-multitouch
#crucial for waveshare screens
sudo dpkg -i linux-image-amlogic-4.9_0.9.4_arm64.deb

#install initial packages
#keep this separate so it is easy to add to
sudo chmod +x KDE_64_APPLICATIONS
sudo ./KDE_64_APPLICATIONS
#install again just in case
sudo ./KDE_64_APPLICATIONS

#remove pulseaudio
sudo apt-get -y autoremove pulseaudio

#remove sddm because it does not start and to avoid conflicts
sudo apt-get autoremove sddm

#shut down these garbage services that eat up the cpu
sudo systemctl disable camera_isp_3a_server.service
sudo systemctl disable hostapd.service

#setup custom alsa rules
cp asoundrc /home/pi/.asoundrc
#setup custom alsa indices
#hopefully not needed going forward
#cp alsa-base.conf /etc/modprobe.d/

#setup miscellaneous
#stop camera modules from loading
sudo cp blacklist.conf /etc/modprobe.d/blacklist.conf
#use lightdm instead of sddm - auto login
#sudo cp sddm.conf /etc/sddm.conf
sudo cp lightdm.conf /etc/lightdm/lightdm.conf
#disable power button shutdown
sudo cp logind.conf /etc/systemd/logind.conf
#setup dhcp server for router functionality
sudo cp udhcpd.conf /etc/udhcpd.conf
#one touch root - less secure but the scripting depends on it for now
sudo cp sudoers /etc/sudoers
#setup xorg portrait mode - no way to quick change with this kernel
sudo cp xorg.conf /etc/X11/xorg.conf
#disable ethernet step 1
sudo cp interfaces /etc/network/interfaces
#this causes suspend to break
#use scripting to disable eth0 instead
#disable ethernet step 2
#sudo cp NetworkManager.conf /etc/NetworkManager/NetworkManager.conf
#just a test video
sudo cp 'Big_Buck_Bunny_first_23_seconds_1080p.ogv' /home/pi
#start on screen keyboard with qt applications
sudo cp environment /etc/environment

#setup convenience notifications
cp 10_PERCENT_BATTERY.svg /home/pi
cp 20_PERCENT_BATTERY.svg /home/pi
cp 30_PERCENT_BATTERY.svg /home/pi
cp 40_PERCENT_BATTERY.svg /home/pi
cp 50_PERCENT_BATTERY.svg /home/pi
cp 60_PERCENT_BATTERY.svg /home/pi
cp 70_PERCENT_BATTERY.svg /home/pi
cp 80_PERCENT_BATTERY.svg /home/pi
cp 90_PERCENT_BATTERY.svg /home/pi
cp 1_BARS.svg /home/pi
cp 2_BARS.svg /home/pi
cp 3_BARS.svg /home/pi
cp 4_BARS.svg /home/pi
cp 5_BARS.svg /home/pi
cp MISSED_CALL.svg /home/pi
cp UNREAD_SMS.svg /home/pi
cp sample_icon.svg /home/pi
cp KDE.svg /home/pi
cp NOTIFICATION_ICON.py /home/pi
cp BATTERY_ICON.py /home/pi
cp SIGNAL_ICON.py /home/pi
cp NOTIFICATION_READOUT /home/pi
cp BATTERY_READOUT /home/pi

#setup cellular networking
cp mbim-network.conf.ATT /home/pi
cp mbim-network.conf.ATTPREPAID /home/pi
cp mbim-network.conf.TMOBILE /home/pi
cp wvdial.conf.ATT /home/pi
cp wvdial.conf.ATTPREPAID /home/pi
cp wvdial.conf.TMOBILE /home/pi
cp wvdial.conf.ATT.313 /home/pi
cp wvdial.conf.ATTPREPAID.313 /home/pi
cp wvdial.conf.TMOBILE.313 /home/pi
cp PROVIDER /home/pi
sudo cp 77-mm-whitelist-rfcomm-modem.rules /etc/udev/rules.d/
sudo udevadm control --reload
sudo udevadm trigger

#setup custom scripts
cp LEFT* /home/pi
cp RIGHT* /home/pi
cp DOWN /home/pi
cp UP /home/pi
cp MAIN_THREAD_KDE.new /home/pi
cp SILENCE /home/pi
cp LTRIS /home/pi
cp NUMPTYPHYSICS /home/pi
cp PINBALL /home/pi
cp WOLF4SDL /home/pi
cp ETRACER /home/pi
cp MODEM /home/pi
cp ON_SCREEN_KEYBOARD /home/pi
cp ROUTER_KDE /home/pi
cp TOUCH /home/pi
cp KILL_GTK* /home/pi
cp GESTURES.jpg /home/pi
cp FIRST_BOOT /home/pi
cp DEBUG_MENU /home/pi
cp CANCEL /home/pi
cp XSESSION_CHILD /home/pi

#setup easystroke
#the configuration
cp -r easystroke /home/pi/.easystroke
#the source code and binaries
cp -r easystroke-0.5.6 /home/pi
(cd /home/pi/easystroke-0.5.6 && sudo make clean && sudo make install)

#setup permissions
sudo chmod 777 /home/pi/NOTIFICATION_READOUT
sudo chmod 777 /home/pi/BATTERY_READOUT
sudo chmod 777 /home/pi/PROVIDER
sudo chmod 777 /home/pi/FIRST_BOOT
sudo chmod +x /home/pi/MAIN_THREAD_KDE.new
sudo chmod +x /home/pi/LEFT*
sudo chmod +x /home/pi/RIGHT*
sudo chmod +x /home/pi/UP
sudo chmod +x /home/pi/DOWN
sudo chmod +x /home/pi/SILENCE
sudo chmod +x /home/pi/ON_SCREEN_KEYBOARD
sudo chmod +x /home/pi/ROUTER_KDE
sudo chmod +x /home/pi/TOUCH
sudo chmod +x /home/pi/KILL_GTK*
sudo chmod +x /home/pi/TOUCH
sudo chmod +x /home/pi/MODEM
sudo chmod +x /home/pi/ETRACER
sudo chmod +x /home/pi/WOLF4SDL
sudo chmod +x /home/pi/PINBALL
sudo chmod +x /home/pi/NUMPTYPHYSICS
sudo chmod +x /home/pi/LTRIS
sudo chmod +x /home/pi/DEBUG_MENU
sudo chmod +x /home/pi/CANCEL
sudo chmod +x /home/pi/XSESSION_CHILD

#setup xsessionrc - this runs at login time
cp xsessionrc /home/pi/.xsessionrc

echo "Now reboot or restart sddm.  You should be automatically logged into KDE.  Log out then finish up by running SETUP_PHASE_2"

